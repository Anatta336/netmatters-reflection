@use 'sass:map';
@import 'variables';

#services {
    margin: 2rem 1rem;
    
    a {
        @include margin-x-centre;
        display: flex;
        flex-direction: column;
        padding: 1.5em;
        margin-top: 0;
        margin-bottom: 2rem;

        text-decoration: none;
        color: $services-text-colour;
        text-align: center;

        background-color: $services-card-background-colour;
        border: 1px solid $services-card-border-colour;
        border-radius: 3px;
        box-shadow: 0 0 30px $services-card-shadow-colour;
    }

    h2 {
        font-size: $services-heading-size;
        font-weight: 400;
    }

    p {
        font-size: $services-para-size;
        line-height: 1.375rem;
    }

    .call-to-action {
        // null $background-colour so the button mixin doesn't generate a
        // background-color property. It will be set on a per-card basis
        // depending on the card's id.
        @include button(
            $background-colour: null,
            $text-colour: $services-button-text-colour,
            $font-size: $services-button-size,
            $width: $services-button-width,
            $height: $services-button-height
        );

        // as this is a flex item, auto for top margin will push it to bottom of container
        margin: auto auto 0;
    }

    // generate a small horizontal line after the h2 element
    h2::after {
        content: '';
        display: block;
        background-color: $services-spacing-line-colour;
        width: $services-spacing-line-width;
        height: $services-spacing-line-height;

        margin: 1rem auto 0;
    }

    // set button's colour based on the id of the service card it's within
    // (assumes that all cards have an id listed in $service-colours)
    @each $service-name, $colour in $service-colours {
        .#{$service-name} .call-to-action {
            background-color: $colour;
        }
    }

    // generate icon appropriate to the id of the service card, placing
    // the icon as a ::before pseudo-element on the card's h2.
    @each $service-name, $icon-name in $icon-name-by-service {
        $icon-unicode: map.get($icon-unicode-by-name, $icon-name);
        $icon-background-colour: map.get($service-colours, $service-name);

        .#{$service-name} h2::before {
            @extend %icon;
            content: $icon-unicode;
            color: $services-icon-colour;

            display: block;
            box-sizing: border-box;
            width: $services-icon-background-size;
            height: $services-icon-background-size;
            background-color: $icon-background-colour;
            border-radius: 50%;

            margin: 0 auto 1.3rem;

            // vertically center icon within the element
            padding-top: ($services-icon-background-size - $services-icon-size) * 0.5;
        }
    }
    
    // past extra-small first 3 cards remain as they are but rest are put into a 2x2 grid
    @media (min-width: map.get($breakpoints, 'extra-small')) {
        @include margin-x-centre;
        width: 46.875rem;

        .other-services {
            @include wrapped-flex;

            // negative margin reverses effect of external margins from children
            margin: 0 -1rem;

            // set up direct children as flex items
            > * {
                margin: 1rem;
                flex-basis: 18rem;
                flex-grow: 1;
            }
        }
    }

    @media (min-width: map.get($breakpoints, 'small')) {
        width: 60.625rem;

        .top-services {
            @include wrapped-flex;
            margin: 0 -1rem;

            > * {
                margin: 1rem;
                flex-basis: 15rem;
                flex-grow: 1;
            }
        }
    }

    @media (min-width: map.get($breakpoints, 'large')) {
        width: 75rem;

        // other-services should form row of 4 at this breakpoint,
        // so reduce their flex-basis to allow them to fit.
        .other-services > * {
            flex-basis: 13rem;
        }
    }
}
